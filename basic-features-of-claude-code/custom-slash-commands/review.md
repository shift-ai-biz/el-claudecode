# コードレビューのルール（詳細版）

## 目的

-   品質、可読性、保守性、セキュリティ、性能を保証するための統一ルール。

## レビュー前準備

-   PR/変更内容の目的を明確にする（チケット参照、要約を記載）。
-   小さな論理単位での提出を推奨（理想は <500 行の変更）。
-   自動テスト・CI を通過させること。

## チェックリスト（必須順）

1. 正しさ
    - 要件を満たしているか（仕様・チケットと照合）。
    - 境界条件・例外処理が適切か。
2. テスト
    - 単体テスト・統合テストが存在し、妥当性を検証しているか。
    - エッジケースと異常系をカバーしているか。
3. 可読性・設計
    - 名前（変数・関数・クラス）が意図を表しているか。
    - 関数は単一責務か（長すぎないか）。
    - ネストが深すぎないか。
4. 保守性
    - 重複コードがないか。共通化可能か。
    - 将来の拡張や変更を容易にする設計か。
5. セキュリティ
    - 入力検証・サニタイズが行われているか。
    - 機密情報や認可の扱いに問題はないか。
6. 性能
    - 明らかな性能ボトルネックはないか（不要なループ、無駄な DB クエリ等）。
    - キャッシュやバッチ処理が必要な場面を見落としていないか。
7. エラーハンドリング・ロギング
    - 適切なエラーメッセージとログレベルか。
    - 例外を無意味に握りつぶしていないか。
8. スタイル・規約
    - プロジェクトのコーディング規約（フォーマット、命名、コメント）に従っているか。
    - Linter/フォーマッタに適合しているか。
9. ドキュメント
    - 公開 API・複雑な処理に対する説明があるか（コメント、README、docstring 等）。
10. デプロイ・運用影響
    - マイグレーションや後方互換性に問題はないか。
    - ロールバック手順が明確か（必要な場合）。

## コメントの書き方

-   具体的に：問題点、期待される動作、改善案を提示する。
-   短く丁寧に：例 — 「ここは X の可能性があるため、Y のチェックを追加してください。」
-   代替案を示す：可能ならコード例を添える。
-   センシティブな指摘は事実ベースで記述する。

## 優先度とラベル付け

-   必須修正（blocking）：動作・セキュリティに直接影響する問題。
-   推奨修正（major）：品質・保守性に大きく影響するが致命的でない。
-   任意（minor）：スタイル改善やリファクタ提案。

## レビューの流れ

1. 初回レビュー：主要な欠陥を指摘し、必要な修正を要求。
2. 再レビュー：修正点が適切に反映されているか確認。
3. 最終確認：テスト・CI・ドキュメントが整っていれば承認。

## 自動化とツール

-   CI でのテスト通過を必須化。
-   Linter、セキュリティスキャナ、依存性チェッカーを導入する。
-   大きな変更はパフォーマンステストを要求する。

## レビュー文化

-   建設的かつ尊重ある言葉で行う。
-   学習の機会と捉え、知見は共有する（テンプレートやベストプラクティスの更新）。

## 例（短縮）

-   NG: 「ここダメです。」
-   OK: 「ここは Null の場合に例外が発生します。入力チェックを追加するか、呼び出し側で保証してください。提案: if x is None: raise ValueError(...)」

以上を基準としてプロジェクト内で統一すること。
